## 快捷键
- M 矩形框
- shift+F5 填充
- V 移动工具
- ctrl+L 缩放、移动、旋转



#### **第一部分：图像处理**

1. **打开原始文件**：在PS或GIMP中，**同时打开**两个文件：
    
    - `my_map.pgm` (您通过SLAM生成的原始地图)
        
    - `your_map.png` (您自己准备的PNG地图)
        
2. **转换PNG为灰度图**: ROS的地图格式要求是灰度图。
    
    - 选中您的 `your_map.png` 图像。
        
    - 在PS中，通过 `图像` -> `模式` -> `灰度`，将PNG文件转换为灰度模式。
        
    - 在GIMP中，通过 `图像` -> `模式` -> `灰度`。
        
3. **理解并统一颜色含义**: 在ROS地图中，颜色有严格定义：
    
    - **纯黑色 (RGB: 0, 0, 0)**: 障碍物 (Occupied)。
        
    - **纯白色 (RGB: 255, 255, 255)**: 可通行区域 (Free)。
        
    - **灰色 (介于黑白之间)**: 未知区域 (Unknown)。
        
    - 您需要确保转换后的PNG灰度图中，您画的墙壁是**纯黑色**，可走的路是**纯白色**。
        
4. **对齐与移植**: 这是最关键的一步。
    
    - 将处理好的PNG灰度图内容**作为一个新图层**，复制并粘贴到 `my_map.pgm` 文件的窗口中。
        
    - 现在您会看到两个图层：原始PGM地图层和您的PNG地图层。
        
    - **降低上层（PNG层）的不透明度**（比如调到50%），这样您就可以同时看到两张图。
        
    - 使用 `移动` 和 `缩放/变换` 工具，**将您的PNG图层与下面的PGM底图对齐**。尽量让公共的墙体、门口等标志性结构完全重合。这一步是为了确保您的新地图与机器人世界的**物理比例和原点**保持一致。
        
    - 对齐后，将PNG图层的不透明度恢复到100%，并隐藏或删除原始的PGM图层。
        
5. **正确保存为PGM**:
    
    - 现在您的画布上只显示您编辑对齐好的新地图内容。
        
    - 在PS中，选择 `文件` -> `另存为`。
        
    - 在格式选项中选择 `PGM`。
        
    - **在弹出的PGM选项中，务必选择“原始(Raw)”或“二进制(Binary)”格式，而不是“ASCII”或“Plain”**。这对应的是`P5`格式，是ROS需要的。
        
    - 文件名可以覆盖原始的 `my_map.pgm`，或者另存为一个新名字（推荐）。
        

#### **第二部分：检查并修改YAML文件**

`pgm`文件只是一张图，真正让它成为“地图”的是同名的`.yaml`文件（例如 `my_map.yaml`）。

YAML

```
image: my_map.pgm
resolution: 0.050000 # 关键！每像素代表多少米
origin: [-10.0, -10.0, 0.0] # 关键！地图左下角在机器人世界坐标系中的位置
negate: 0
occupied_thresh: 0.65
free_thresh: 0.196
```

- **如果您在上面的第4步中，完美地将新地图与旧的PGM底图对齐了**，并且没有改变图像的总像素尺寸，那么恭喜您，`resolution` (分辨率) 和 `origin` (原点) 这两个最重要的参数**大概率不需要修改**。
    
- **如果您显著地缩放了地图或者改变了画布尺寸**，那么这两个参数就必须重新计算，这是一个非常繁琐且容易出错的过程。这就是为什么我们强烈建议使用原始PGM作为底版来对齐。
    
- **如果您另存为新文件名**，比如 `new_map.pgm`，那么您必须：
    
    1. 复制一份 `my_map.yaml` 并改名为 `new_map.yaml`。
        
    2. 打开 `new_map.yaml`，将第一行的 `image: my_map.pgm` 改为 `image: new_map.pgm`。
        
    3. 别忘了去 `nav_bringup.launch.py` 文件里，把调用的地图也改成 `new_map.yaml`。